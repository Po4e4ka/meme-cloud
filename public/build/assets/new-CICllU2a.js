import{r as a,j as t,H as ce}from"./app-gXqGlHNq.js";import{A as de}from"./app-layout-CeiySOWF.js";import{I as me}from"./index-BU4V5GPG.js";import{A as ue,C as xe}from"./index.module-BYek3MmP.js";import{a as p}from"./createLucideIcon-BqQKbMjN.js";import{M as pe}from"./monitor-DNrg5p2M.js";import{C as he}from"./check-DZo1AURH.js";/* empty css            */import"./index-Cjq5TNqr.js";import"./index-CKGNssgb.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]],ge=p("Crop",fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],be=p("FileImage",ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],ye=p("Ruler",je);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],we=p("Upload",Ne),Ce=[{title:"Создать новый мемчик",href:""}],ke=[{Icon:ue,target_url:"/",isActive:!1}];function Fe(){const[C,G]=a.useState(""),[l,q]=a.useState(null),[i,K]=a.useState(null),[O,h]=a.useState(!1),k=a.useRef(null),m=a.useRef(null),[B,E]=a.useState({x:0,y:0}),[I,f]=a.useState(1),[u,P]=a.useState(null),[D,g]=a.useState(null),[J,L]=a.useState(0),[S,v]=a.useState(0),[R,T]=a.useState(null),[W,_]=a.useState(null),c=198,d=258,b=c/d;function Q(e){F(e.target.files?.[0]??null)}function F(e){e&&(q(e),g(null),T(null),_(null),L(0),v(0),E({x:0,y:0}),f(1),P(null),K(URL.createObjectURL(e)))}function X(e){e.preventDefault(),h(!1);const s=e.dataTransfer.files?.[0]??null;F(s)}function Y(e){if(e.preventDefault(),!l){alert("Выберите файл");return}if(l.type.startsWith("image/")&&!u){alert("Выберите область превью");return}const s=new FormData;s.append("name",C),s.append("file",l),x.forEach((r,o)=>{s.append(`tags[${o}]`,r)});const n=new me().v1().meme();le().then(r=>{r&&s.append("preview",r),n.new(s)}).catch(()=>{alert("Не удалось подготовить превью")})}const[H,U]=a.useState(""),[x,M]=a.useState([]);function ee(e){return/^[A-Za-zА-Яа-я0-9 ]+$/.test(e)&&!/ {3,}/.test(e)}function te(e){if(e.key==="Enter"){e.preventDefault();const s=H.trim();if(!s)return;if(!ee(s)){alert("Тег может содержать только буквы, цифры и максимум два пробела подряд.");return}x.includes(s)||M([...x,s]),U("")}}function se(e){M(x.filter(s=>s!==e))}const ae=a.useCallback((e,s)=>{P(s)},[]);a.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]);const V=a.useCallback(e=>new Promise((s,n)=>{const r=new Image;r.addEventListener("load",()=>s(r)),r.addEventListener("error",n),r.src=e}),[]),j=a.useCallback(async(e,s)=>{const n=await V(e),r=document.createElement("canvas");r.width=c,r.height=d;const o=r.getContext("2d");if(!o)throw new Error("Canvas context missing");return o.drawImage(n,s.x,s.y,s.width,s.height,0,0,c,d),r},[d,c,V]);a.useEffect(()=>{if(!i||!l||!u||!l.type.startsWith("image/"))return;let e=!1;return j(i,u).then(s=>{if(e)return;const n=s.toDataURL("image/jpeg",.9);g(n)}).catch(()=>{e||g(null)}),()=>{e=!0}},[i,l,u,j]);const y=a.useCallback(async()=>{if(!m.current)return;const e=m.current,s=document.createElement("canvas");s.width=c,s.height=d;const n=s.getContext("2d");if(!n)return null;const r=e.videoWidth/e.videoHeight,o=b;let z=0,A=0,N=e.videoWidth,w=e.videoHeight;r>o?(N=e.videoHeight*o,z=(e.videoWidth-N)/2):r<o&&(w=e.videoWidth/o,A=(e.videoHeight-w)/2),n.drawImage(e,z,A,N,w,0,0,c,d);const $=await new Promise(ie=>{s.toBlob(oe=>ie(oe),"image/jpeg",.9)});if(!$)return null;const Z=new File([$],"preview.jpg",{type:"image/jpeg"}),ne=s.toDataURL("image/jpeg",.9);return _(Z),T(ne),Z},[b,d,c]);a.useEffect(()=>{if(!i||!l||!l.type.startsWith("video/"))return;const e=m.current;if(!e)return;const s=()=>{L(e.duration),v(0),e.currentTime=0},n=()=>{y()};return e.addEventListener("loadedmetadata",s),e.addEventListener("seeked",n),()=>{e.removeEventListener("loadedmetadata",s),e.removeEventListener("seeked",n)}},[i,l,y]);const re=e=>{m.current&&(v(e),m.current.currentTime=e)},le=async()=>{if(!l)return null;if(l.type.startsWith("image/")){if(!i||!u)return null;const e=await j(i,u),s=await new Promise(n=>{e.toBlob(r=>n(r),"image/jpeg",.9)});return s?new File([s],"preview.jpg",{type:"image/jpeg"}):null}return l.type.startsWith("video/")?W||(await y()??null):null};return t.jsxs(de,{breadcrumbs:Ce,actions:ke,children:[t.jsx(ce,{title:"Создать мем"}),t.jsx("div",{className:"w-full p-6",children:t.jsxs("div",{className:"w-full rounded-2xl border border-slate-800 bg-slate-950/80 p-6 shadow-xl",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-6",children:"Создать новый мем"}),t.jsx("form",{onSubmit:Y,className:"text-slate-100",children:t.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium mb-2 text-slate-200",children:"Файл"}),t.jsx("div",{onClick:()=>k.current?.click(),onDragOver:e=>{e.preventDefault(),h(!0)},onDragLeave:()=>h(!1),onDrop:X,className:`border-2 border-dashed rounded-xl px-4 py-8 text-center cursor-pointer transition ${O?"border-cyan-400 bg-cyan-500/10":"border-slate-700 bg-slate-900/70"}`,children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"rounded-full bg-slate-900 p-3 shadow-sm border border-slate-700",children:t.jsx(we,{size:20,className:"text-cyan-300"})}),t.jsx("div",{className:"font-medium",children:"Перетащите файл сюда"}),t.jsx("div",{className:"text-sm text-slate-400",children:"или нажмите, чтобы выбрать"}),l&&t.jsx("div",{className:"text-sm text-slate-300",children:l.name})]})}),t.jsx("input",{ref:k,type:"file",onChange:Q,accept:"image/*,video/*",className:"hidden"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-slate-800 bg-slate-900/80 p-3",children:[t.jsx(ye,{size:18,className:"text-slate-300"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Размер"}),t.jsx("div",{className:"text-xs text-slate-400",children:"до 50 МБ"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-slate-800 bg-slate-900/80 p-3",children:[t.jsx(be,{size:18,className:"text-slate-300"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Формат"}),t.jsx("div",{className:"text-xs text-slate-400",children:"JPG, PNG, GIF, MP4"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-slate-800 bg-slate-900/80 p-3",children:[t.jsx(pe,{size:18,className:"text-slate-300"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Разрешение"}),t.jsx("div",{className:"text-xs text-slate-400",children:"до 4K"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-slate-800 bg-slate-900/80 p-3",children:[t.jsx(ge,{size:18,className:"text-slate-300"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Соотношение"}),t.jsx("div",{className:"text-xs text-slate-400",children:"1:1, 4:5, 9:16"})]})]})]}),i&&t.jsxs("div",{className:"mt-2 space-y-3",children:[t.jsx("p",{className:"font-medium text-slate-200",children:"Предпросмотр и выбор превью 9:16"}),l?.type.startsWith("video/")?t.jsxs("div",{className:"space-y-3",children:[t.jsx("video",{ref:m,src:i,className:"rounded-xl max-h-64 object-contain border border-slate-800 w-full bg-slate-900/70",controls:!0}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"range",min:0,max:Math.max(0,J),step:.1,value:S,onChange:e=>re(Number(e.target.value)),className:"w-full"}),t.jsxs("span",{className:"text-xs text-slate-400 w-12 text-right",children:[S.toFixed(1),"s"]})]}),R&&t.jsx("img",{src:R,alt:"preview",className:"rounded-xl max-h-64 object-contain border border-slate-800 w-full bg-slate-900/70"})]}):t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"relative h-80 w-full overflow-hidden rounded-xl border border-slate-800 bg-slate-900/70",children:t.jsx(xe,{image:i,crop:B,zoom:I,aspect:b,onCropChange:E,onZoomChange:f,onCropComplete:ae})}),t.jsx("input",{type:"range",min:1,max:3,step:.05,value:I,onChange:e=>f(Number(e.target.value)),className:"w-full"}),D&&t.jsx("img",{src:D,alt:"preview",className:"rounded-xl max-h-64 object-contain border border-slate-800 w-full bg-slate-900/70"})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium mb-1 text-slate-200",children:"Название"}),t.jsx("input",{value:C,onChange:e=>G(e.target.value),className:"border border-slate-800 rounded-lg px-3 py-2 w-full bg-slate-900/80 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/60",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium mb-1 text-slate-200",children:"Теги"}),t.jsx("input",{type:"text",value:H,onChange:e=>U(e.target.value),onKeyDown:te,placeholder:"Введите тег и нажмите Enter",className:"border border-slate-800 rounded-lg px-3 py-2 w-full bg-slate-900/80 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/60"}),t.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:x.map(e=>t.jsxs("span",{className:"px-2 py-1 bg-emerald-500/15 text-emerald-200 border border-emerald-500/40 rounded-full flex items-center gap-1 text-sm",children:[e,t.jsx("button",{type:"button",className:"text-rose-300 hover:text-rose-200",onClick:()=>se(e),children:"×"})]},e))})]}),t.jsx("div",{className:"flex justify-center pt-2",children:t.jsxs("button",{type:"submit",className:"flex items-center gap-2 bg-cyan-500 text-slate-900 rounded-lg px-6 py-2.5 font-semibold hover:bg-cyan-400 transition",children:[t.jsx(he,{size:18}),"Добавить"]})})]})]})})]})})]})}export{Fe as default};
